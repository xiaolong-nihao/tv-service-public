<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨è®¾å¤‡æˆæƒç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --dark: #1f2937;
            --light: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #f1f5f9;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn-block {
            display: flex;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
            margin: 5px;
        }
        
        .status-authorized {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-unauthorized {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .device-fingerprint {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
            font-size: 12px;
        }
        
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            z-index: 10000;
        }
        
        .storage-info {
            background: #f0f9ff;
            border: 2px solid #dbeafe;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- å­˜å‚¨é…ç½®ç•Œé¢ -->
    <div id="storageConfigPage" class="container">
        <div class="header">
            <h1>ğŸ’¾ å­˜å‚¨é…ç½®</h1>
            <p>é€‰æ‹©æ‚¨çš„æ•°æ®å­˜å‚¨æ–¹å¼</p>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h3 style="margin-bottom: 20px;">é€‰æ‹©å­˜å‚¨æœåŠ¡</h3>
                
                <!-- JSONBin.io é€‰é¡¹ -->
                <div style="margin-bottom: 25px; padding: 20px; border: 2px solid #e2e8f0; border-radius: 12px;">
                    <h4 style="margin-bottom: 10px;">ğŸ”— JSONBin.io (æ¨è)</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 14px;">
                        å…è´¹çš„JSONå­˜å‚¨æœåŠ¡ï¼Œéœ€è¦APIå¯†é’¥
                    </p>
                    <div class="form-group">
                        <label>JSONBin API Key:</label>
                        <input type="password" id="jsonbinKey" class="form-control" 
                               placeholder="ä» jsonbin.io è·å–çš„ API Key">
                    </div>
                    <div class="form-group">
                        <label>Bin ID (å¯é€‰):</label>
                        <input type="text" id="jsonbinId" class="form-control" 
                               placeholder="ç•™ç©ºå°†è‡ªåŠ¨åˆ›å»º">
                    </div>
                    <button class="btn btn-primary" onclick="setupJSONBinStorage()">
                        ğŸš€ ä½¿ç”¨ JSONBin å­˜å‚¨
                    </button>
                </div>

                <!-- Pastebin.com é€‰é¡¹ -->
                <div style="margin-bottom: 25px; padding: 20px; border: 2px solid #e2e8f0; border-radius: 12px;">
                    <h4 style="margin-bottom: 10px;">ğŸ“‹ Pastebin.com</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 14px;">
                        ä½¿ç”¨ Pastebin å­˜å‚¨åŠ å¯†æ•°æ®
                    </p>
                    <div class="form-group">
                        <label>Pastebin é“¾æ¥:</label>
                        <input type="text" id="pastebinUrl" class="form-control" 
                               placeholder="Pastebin å®Œæ•´é“¾æ¥">
                    </div>
                    <button class="btn btn-primary" onclick="setupPastebinStorage()">
                        ğŸ“‹ ä½¿ç”¨ Pastebin å­˜å‚¨
                    </button>
                </div>

                <!-- GitHub Gist é€‰é¡¹ -->
                <div style="padding: 20px; border: 2px solid #e2e8f0; border-radius: 12px;">
                    <h4 style="margin-bottom: 10px;">ğŸ™ GitHub Gist</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 14px;">
                        ä½¿ç”¨ GitHub Gist å­˜å‚¨æ•°æ®
                    </p>
                    <div class="form-group">
                        <label>Gist ID:</label>
                        <input type="text" id="gistId" class="form-control" 
                               placeholder="Gist ID">
                    </div>
                    <button class="btn btn-primary" onclick="setupGistStorage()">
                        ğŸ™ ä½¿ç”¨ Gist å­˜å‚¨
                    </button>
                </div>

                <!-- æ‰‹åŠ¨å¤‡ä»½é€‰é¡¹ -->
                <div style="margin-top: 25px; padding: 20px; background: #f0fdf4; border-radius: 12px;">
                    <h4 style="margin-bottom: 10px;">ğŸ’¾ æ‰‹åŠ¨å¤‡ä»½</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 14px;">
                        æ‰‹åŠ¨å¯¼å…¥/å¯¼å‡ºåŠ å¯†æ•°æ®æ–‡ä»¶
                    </p>
                    <div class="form-group">
                        <label>ç§æœ‰ç©ºé—´å¯†é’¥:</label>
                        <input type="password" id="backupKey" class="form-control" 
                               placeholder="è®¾ç½®ç§æœ‰ç©ºé—´å¯†é’¥">
                    </div>
                    <button class="btn btn-success" onclick="setupManualStorage()">
                        ğŸ“ ä½¿ç”¨æ‰‹åŠ¨å¤‡ä»½
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡æˆæƒç™»å½•ç•Œé¢ -->
    <div id="authPage" class="container" style="display: none;">
        <div class="header">
            <h1>ğŸ”’ å®‰å…¨è®¾å¤‡æˆæƒç³»ç»Ÿ</h1>
            <p>åŸºäºå¤–é“¾å­˜å‚¨çš„å®‰å…¨è®¤è¯</p>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h3 style="margin-bottom: 15px;">è®¿é—®æˆæƒç³»ç»Ÿ</h3>
                
                <div id="storageInfo" class="storage-info">
                    <!-- å­˜å‚¨ä¿¡æ¯æ˜¾ç¤º -->
                </div>
                
                <div class="form-group">
                    <label>ç®¡ç†å‘˜å¯†ç :</label>
                    <input type="password" id="adminPassword" class="form-control" 
                           placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç " value="123456">
                </div>
                
                <button class="btn btn-primary btn-block" onclick="authenticateDevice()">
                    ğŸ”‘ éªŒè¯è®¾å¤‡æƒé™
                </button>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn btn-light" onclick="showStorageConfig()">
                        âš™ï¸ é‡æ–°é…ç½®å­˜å‚¨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»ç®¡ç†ç³»ç»Ÿ -->
    <div id="adminPage" class="container" style="display: none;">
        <div class="header">
            <h1>ğŸ“± è®¾å¤‡æˆæƒç®¡ç†ç³»ç»Ÿ</h1>
            <p id="storageTypeInfo">å¤–é“¾å­˜å‚¨ | å®‰å…¨æ•°æ®</p>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h3 style="margin-bottom: 15px;">è®¾å¤‡ç®¡ç†</h3>
                
                <div id="currentDeviceStatus" class="status-badge status-authorized">
                    âœ… å½“å‰è®¾å¤‡å·²æˆæƒ
                </div>
                
                <div class="device-fingerprint" id="currentFingerprint">
                    <!-- è®¾å¤‡æŒ‡çº¹æ˜¾ç¤º -->
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="showAddDeviceModal()">
                        â• æ·»åŠ æˆæƒè®¾å¤‡
                    </button>
                    <button class="btn btn-success" onclick="syncData()">
                        ğŸ”„ åŒæ­¥æ•°æ®
                    </button>
                    <button class="btn btn-light" onclick="exportBackup()">
                        ğŸ’¾ å¤‡ä»½æ•°æ®
                    </button>
                </div>

                <div id="authorizedDevicesList">
                    <!-- æˆæƒè®¾å¤‡åˆ—è¡¨ -->
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px;">å­˜å‚¨ç®¡ç†</h3>
                <div id="storageStatus" class="storage-info">
                    <!-- å­˜å‚¨çŠ¶æ€ä¿¡æ¯ -->
                </div>
                <button class="btn btn-light" onclick="showStorageConfig()">
                    âš™ï¸ ç®¡ç†å­˜å‚¨é…ç½®
                </button>
            </div>
        </div>
    </div>

    <script>
        // å­˜å‚¨é…ç½®
        let storageConfig = {
            type: null, // 'jsonbin', 'pastebin', 'gist', 'manual'
            apiKey: null,
            binId: null,
            privateKey: null
        };

        // ç³»ç»Ÿæ•°æ®
        let deviceFingerprint = null;
        let authorizedDevices = [];
        let currentSession = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStorageConfig();
            initializeDeviceFingerprint();
        });

        // åŠ è½½å­˜å‚¨é…ç½®
        function loadStorageConfig() {
            const savedConfig = localStorage.getItem('storageConfig');
            if (savedConfig) {
                storageConfig = JSON.parse(savedConfig);
                showAuthPage();
            } else {
                showStorageConfigPage();
            }
        }

        // æ˜¾ç¤ºå­˜å‚¨é…ç½®é¡µé¢
        function showStorageConfigPage() {
            document.getElementById('storageConfigPage').style.display = 'block';
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'none';
        }

        // æ˜¾ç¤ºè®¤è¯é¡µé¢
        function showAuthPage() {
            document.getElementById('storageConfigPage').style.display = 'none';
            document.getElementById('authPage').style.display = 'block';
            document.getElementById('adminPage').style.display = 'none';
            
            updateStorageInfo();
        }

        // æ˜¾ç¤ºç®¡ç†é¡µé¢
        function showAdminPage() {
            document.getElementById('storageConfigPage').style.display = 'none';
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'block';
            
            updateAdminInterface();
        }

        // åˆå§‹åŒ–è®¾å¤‡æŒ‡çº¹
        async function initializeDeviceFingerprint() {
            const components = [
                navigator.userAgent,
                navigator.platform,
                navigator.language,
                navigator.hardwareConcurrency || 'unknown',
                screen.width + 'x' + screen.height,
                new Date().getTimezoneOffset().toString()
            ];
            
            const fingerprintString = components.join('|');
            deviceFingerprint = await sha256(fingerprintString);
        }

        // SHA256 å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // è®¾ç½® JSONBin å­˜å‚¨
        async function setupJSONBinStorage() {
            const apiKey = document.getElementById('jsonbinKey').value.trim();
            const binId = document.getElementById('jsonbinId').value.trim();
            
            if (!apiKey) {
                alert('è¯·è¾“å…¥ JSONBin API Key');
                return;
            }
            
            storageConfig = {
                type: 'jsonbin',
                apiKey: apiKey,
                binId: binId,
                privateKey: await generatePrivateKey()
            };
            
            await saveStorageConfig();
            await initializeData();
            showToast('JSONBin å­˜å‚¨é…ç½®æˆåŠŸ');
            showAuthPage();
        }

        // è®¾ç½® Pastebin å­˜å‚¨
        async function setupPastebinStorage() {
            const pastebinUrl = document.getElementById('pastebinUrl').value.trim();
            
            if (!pastebinUrl) {
                alert('è¯·è¾“å…¥ Pastebin é“¾æ¥');
                return;
            }
            
            storageConfig = {
                type: 'pastebin',
                pastebinUrl: pastebinUrl,
                privateKey: await generatePrivateKey()
            };
            
            await saveStorageConfig();
            await initializeData();
            showToast('Pastebin å­˜å‚¨é…ç½®æˆåŠŸ');
            showAuthPage();
        }

        // è®¾ç½®æ‰‹åŠ¨å¤‡ä»½
        async function setupManualStorage() {
            const privateKey = document.getElementById('backupKey').value.trim();
            
            if (!privateKey) {
                alert('è¯·è¾“å…¥ç§æœ‰ç©ºé—´å¯†é’¥');
                return;
            }
            
            storageConfig = {
                type: 'manual',
                privateKey: await sha256(privateKey)
            };
            
            await saveStorageConfig();
            await initializeData();
            showToast('æ‰‹åŠ¨å¤‡ä»½é…ç½®æˆåŠŸ');
            showAuthPage();
        }

        // ç”Ÿæˆç§æœ‰å¯†é’¥
        async function generatePrivateKey() {
            const randomData = new Uint8Array(32);
            crypto.getRandomValues(randomData);
            return Array.from(randomData).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ä¿å­˜å­˜å‚¨é…ç½®
        async function saveStorageConfig() {
            localStorage.setItem('storageConfig', JSON.stringify(storageConfig));
        }

        // åˆå§‹åŒ–æ•°æ®
        async function initializeData() {
            // å°è¯•ä»è¿œç¨‹å­˜å‚¨åŠ è½½æ•°æ®
            const remoteData = await loadRemoteData();
            
            if (remoteData) {
                authorizedDevices = remoteData.authorizedDevices || [];
            } else {
                // é¦–æ¬¡ä½¿ç”¨ï¼Œåˆ›å»ºåˆå§‹æ•°æ®
                authorizedDevices = [];
                await saveRemoteData();
            }
        }

        // åŠ è½½è¿œç¨‹æ•°æ®
        async function loadRemoteData() {
            try {
                switch (storageConfig.type) {
                    case 'jsonbin':
                        return await loadFromJSONBin();
                    case 'pastebin':
                        return await loadFromPastebin();
                    case 'manual':
                        return await loadFromLocalStorage();
                    default:
                        return null;
                }
            } catch (error) {
                console.error('åŠ è½½è¿œç¨‹æ•°æ®å¤±è´¥:', error);
                return null;
            }
        }

        // ä» JSONBin åŠ è½½æ•°æ®
        async function loadFromJSONBin() {
            const binId = storageConfig.binId;
            if (!binId) return null;
            
            const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                headers: {
                    'X-Master-Key': storageConfig.apiKey
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                return decryptData(data.record);
            }
            return null;
        }

        // ä¿å­˜åˆ° JSONBin
        async function saveToJSONBin() {
            const dataToSave = {
                authorizedDevices: authorizedDevices,
                lastUpdate: new Date().toISOString()
            };
            
            const encryptedData = encryptData(dataToSave);
            
            let url = 'https://api.jsonbin.io/v3/b';
            let method = 'POST';
            
            if (storageConfig.binId) {
                url = `https://api.jsonbin.io/v3/b/${storageConfig.binId}`;
                method = 'PUT';
            }
            
            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': storageConfig.apiKey,
                    'X-Bin-Name': 'DeviceAuthSystem'
                },
                body: JSON.stringify(encryptedData)
            });
            
            if (response.ok) {
                const result = await response.json();
                if (!storageConfig.binId) {
                    storageConfig.binId = result.metadata.id;
                    await saveStorageConfig();
                }
                return true;
            }
            return false;
        }

        // åŠ å¯†æ•°æ®
        function encryptData(data) {
            // ç®€å•çš„ XOR åŠ å¯†ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†æ–¹æ³•ï¼‰
            const jsonStr = JSON.stringify(data);
            let encrypted = '';
            for (let i = 0; i < jsonStr.length; i++) {
                encrypted += String.fromCharCode(jsonStr.charCodeAt(i) ^ storageConfig.privateKey.charCodeAt(i % storageConfig.privateKey.length));
            }
            return btoa(encrypted);
        }

        // è§£å¯†æ•°æ®
        function decryptData(encryptedData) {
            try {
                const decoded = atob(encryptedData);
                let decrypted = '';
                for (let i = 0; i < decoded.length; i++) {
                    decrypted += String.fromCharCode(decoded.charCodeAt(i) ^ storageConfig.privateKey.charCodeAt(i % storageConfig.privateKey.length));
                }
                return JSON.parse(decrypted);
            } catch (error) {
                return null;
            }
        }

        // è®¾å¤‡è®¤è¯
        async function authenticateDevice() {
            const password = document.getElementById('adminPassword').value;
            
            if (!password) {
                alert('è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ');
                return;
            }
            
            // åŠ è½½æœ€æ–°æ•°æ®
            await initializeData();
            
            // æ£€æŸ¥è®¾å¤‡æˆæƒ
            if (isDeviceAuthorized()) {
                createSession();
                showAdminPage();
                showToast('âœ… è®¾å¤‡è®¤è¯æˆåŠŸ');
            } else {
                // é¦–æ¬¡ä½¿ç”¨ï¼Œè‡ªåŠ¨æˆæƒ
                if (authorizedDevices.length === 0) {
                    authorizedDevices.push({
                        fingerprint: deviceFingerprint,
                        note: 'ç®¡ç†å‘˜è®¾å¤‡',
                        authTime: new Date().toISOString()
                    });
                    await saveRemoteData();
                    createSession();
                    showAdminPage();
                    showToast('ğŸ‰ ç®¡ç†å‘˜è®¾å¤‡å·²æˆæƒ');
                } else {
                    showToast('âŒ è®¾å¤‡æœªæˆæƒ');
                }
            }
        }

        // æ£€æŸ¥è®¾å¤‡æ˜¯å¦å·²æˆæƒ
        function isDeviceAuthorized() {
            return authorizedDevices.some(device => device.fingerprint === deviceFingerprint);
        }

        // åˆ›å»ºä¼šè¯
        function createSession() {
            currentSession = {
                fingerprint: deviceFingerprint,
                loginTime: new Date().toISOString()
            };
        }

        // æ›´æ–°å­˜å‚¨ä¿¡æ¯
        function updateStorageInfo() {
            const storageInfo = document.getElementById('storageInfo');
            let infoText = '';
            
            switch (storageConfig.type) {
                case 'jsonbin':
                    infoText = `ğŸ“Š å­˜å‚¨æ–¹å¼: JSONBin.io<br>Bin ID: ${storageConfig.binId || 'æœªåˆ›å»º'}`;
                    break;
                case 'pastebin':
                    infoText = `ğŸ“‹ å­˜å‚¨æ–¹å¼: Pastebin<br>URL: ${storageConfig.pastebinUrl}`;
                    break;
                case 'manual':
                    infoText = `ğŸ’¾ å­˜å‚¨æ–¹å¼: æ‰‹åŠ¨å¤‡ä»½<br>æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°`;
                    break;
            }
            
            storageInfo.innerHTML = infoText;
        }

        // æ›´æ–°ç®¡ç†ç•Œé¢
        function updateAdminInterface() {
            document.getElementById('currentFingerprint').textContent = `è®¾å¤‡æŒ‡çº¹: ${deviceFingerprint}`;
            document.getElementById('storageTypeInfo').textContent = `${getStorageTypeName()} | ${authorizedDevices.length} ä¸ªè®¾å¤‡`;
            
            updateDevicesList();
            updateStorageStatus();
        }

        // è·å–å­˜å‚¨ç±»å‹åç§°
        function getStorageTypeName() {
            switch (storageConfig.type) {
                case 'jsonbin': return 'JSONBin';
                case 'pastebin': return 'Pastebin';
                case 'manual': return 'æ‰‹åŠ¨å¤‡ä»½';
                default: return 'æœªçŸ¥';
            }
        }

        // æ›´æ–°è®¾å¤‡åˆ—è¡¨
        function updateDevicesList() {
            const listDiv = document.getElementById('authorizedDevicesList');
            listDiv.innerHTML = '<h4>å·²æˆæƒè®¾å¤‡:</h4>';
            
            authorizedDevices.forEach(device => {
                const isCurrent = device.fingerprint === deviceFingerprint;
                const deviceDiv = document.createElement('div');
                deviceDiv.className = 'device-fingerprint';
                deviceDiv.innerHTML = `
                    <strong>${device.note}</strong>
                    ${isCurrent ? '<span class="status-badge status-authorized">å½“å‰è®¾å¤‡</span>' : ''}
                    <br><small>${device.fingerprint.substring(0, 32)}...</small>
                    <br><small>æˆæƒæ—¶é—´: ${new Date(device.authTime).toLocaleString()}</small>
                    ${!isCurrent ? `<button class="btn" style="background: #ef4444; color: white; padding: 5px 10px; margin-top: 5px;" onclick="removeDevice('${device.fingerprint}')">ç§»é™¤</button>` : ''}
                `;
                listDiv.appendChild(deviceDiv);
            });
        }

        // æ›´æ–°å­˜å‚¨çŠ¶æ€
        function updateStorageStatus() {
            const statusDiv = document.getElementById('storageStatus');
            statusDiv.innerHTML = `
                <strong>å­˜å‚¨çŠ¶æ€:</strong><br>
                ç±»å‹: ${getStorageTypeName()}<br>
                è®¾å¤‡æ•°é‡: ${authorizedDevices.length}<br>
                æœ€ååŒæ­¥: ${new Date().toLocaleString()}
            `;
        }

        // ä¿å­˜è¿œç¨‹æ•°æ®
        async function saveRemoteData() {
            try {
                switch (storageConfig.type) {
                    case 'jsonbin':
                        return await saveToJSONBin();
                    case 'pastebin':
                        return await saveToPastebin();
                    case 'manual':
                        return await saveToLocalStorage();
                    default:
                        return false;
                }
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                return false;
            }
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ‰‹åŠ¨å¤‡ä»½æ¨¡å¼ï¼‰
        async function saveToLocalStorage() {
            const dataToSave = {
                authorizedDevices: authorizedDevices,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem('manualBackupData', encryptData(dataToSave));
            return true;
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ï¼ˆæ‰‹åŠ¨å¤‡ä»½æ¨¡å¼ï¼‰
        async function loadFromLocalStorage() {
            const encryptedData = localStorage.getItem('manualBackupData');
            if (encryptedData) {
                return decryptData(encryptedData);
            }
            return null;
        }

        // åŒæ­¥æ•°æ®
        async function syncData() {
            showToast('ğŸ”„ åŒæ­¥æ•°æ®ä¸­...');
            await initializeData();
            updateAdminInterface();
            showToast('âœ… æ•°æ®åŒæ­¥å®Œæˆ');
        }

        // å¯¼å‡ºå¤‡ä»½
        async function exportBackup() {
            const dataToExport = {
                authorizedDevices: authorizedDevices,
                exportTime: new Date().toISOString(),
                system: 'DeviceAuthSystem'
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `device_auth_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ğŸ’¾ å¤‡ä»½æ–‡ä»¶å·²ä¸‹è½½');
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ç”±äºä»£ç é•¿åº¦é™åˆ¶ï¼Œè¿™é‡Œåªå®ç°äº†æ ¸å¿ƒåŠŸèƒ½
        // å®é™…ä½¿ç”¨æ—¶éœ€è¦è¡¥å……å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå…¶ä»–åŠŸèƒ½
    </script>
</body>
</html>
