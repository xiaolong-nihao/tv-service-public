<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨è®¾å¤‡æˆæƒç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .main-content {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .security-info {
            background: #f0f9ff;
            border: 2px solid #dbeafe;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .device-fingerprint {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            word-break: break-all;
            font-size: 12px;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-authorized {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-unauthorized {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .device-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .table-header {
            background: #f8fafc;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .table-row {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            border-bottom: 1px solid #e2e8f0;
            transition: background 0.3s;
        }
        
        .table-row:hover {
            background: #f8fafc;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 28px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body>
    <!-- è®¾å¤‡æˆæƒç™»å½•ç•Œé¢ -->
    <div id="authPage" class="container">
        <div class="header">
            <h1>ğŸ”’ å®‰å…¨è®¾å¤‡æˆæƒç³»ç»Ÿ</h1>
            <p>åŸºäºè®¾å¤‡æŒ‡çº¹çš„å®‰å…¨è®¤è¯</p>
        </div>
        
        <div class="main-content">
            <div class="security-info">
                <h3 style="margin-bottom: 10px;">ğŸ” å®‰å…¨è®¤è¯</h3>
                <p style="color: #64748b; font-size: 14px;">
                    ç³»ç»Ÿæ­£åœ¨éªŒè¯æ‚¨çš„è®¾å¤‡æŒ‡çº¹ï¼Œåªæœ‰æˆæƒçš„è®¾å¤‡å¯ä»¥è®¿é—®ç®¡ç†ç³»ç»Ÿã€‚
                </p>
            </div>
            
            <div id="deviceInfo">
                <!-- è®¾å¤‡æŒ‡çº¹ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <div id="authSection">
                <div class="form-group">
                    <label>ç®¡ç†å‘˜å¯†ç ï¼š</label>
                    <input type="password" id="adminPassword" class="form-control" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
                </div>
                
                <button class="btn btn-primary" onclick="authenticateDevice()">
                    ğŸ”‘ éªŒè¯è®¾å¤‡æƒé™
                </button>
            </div>
            
            <div id="pendingSection" style="display: none;">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">â³</div>
                    <h3 style="margin-bottom: 10px;">ç­‰å¾…è®¾å¤‡æˆæƒ</h3>
                    <p style="color: #64748b; margin-bottom: 20px;">
                        æ‚¨çš„è®¾å¤‡æ­£åœ¨ç­‰å¾…ç®¡ç†å‘˜æˆæƒ...
                    </p>
                    <div class="device-fingerprint" id="pendingFingerprint"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»ç®¡ç†ç³»ç»Ÿ -->
    <div id="adminPage" class="container" style="display: none;">
        <div class="header">
            <h1>ğŸ“± è®¾å¤‡æˆæƒç®¡ç†ç³»ç»Ÿ</h1>
            <p>å®‰å…¨è®¾å¤‡ç®¡ç†å¹³å°</p>
        </div>
        
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>å·²æˆæƒè®¾å¤‡</h2>
                <span class="status-badge status-authorized" id="currentDeviceStatus">å½“å‰è®¾å¤‡å·²æˆæƒ</span>
            </div>
            
            <div class="security-info">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <strong>è®¾å¤‡æŒ‡çº¹ï¼š</strong><br>
                        <span id="currentFingerprint" style="font-size: 12px; color: #64748b;"></span>
                    </div>
                    <div>
                        <strong>æˆæƒæ—¶é—´ï¼š</strong><br>
                        <span id="authTime" style="font-size: 12px; color: #64748b;"></span>
                    </div>
                </div>
            </div>
            
            <div class="toggle-label">
                <span>ğŸ”’ ä¸¥æ ¼è®¾å¤‡éªŒè¯æ¨¡å¼</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="strictMode" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <button class="btn btn-primary" onclick="showAddDeviceModal()" style="margin-bottom: 15px;">
                â• æ·»åŠ æˆæƒè®¾å¤‡
            </button>
            
            <div class="device-table">
                <div class="table-header">
                    <div>è®¾å¤‡ä¿¡æ¯</div>
                    <div>æˆæƒæ—¶é—´</div>
                    <div>çŠ¶æ€</div>
                </div>
                <div id="authorizedDevicesList">
                    <!-- æˆæƒè®¾å¤‡åˆ—è¡¨ -->
                </div>
            </div>
            
            <button class="btn btn-danger" onclick="logout()" style="margin-top: 20px;">
                ğŸšª å®‰å…¨é€€å‡º
            </button>
        </div>
    </div>

    <!-- æ·»åŠ è®¾å¤‡æ¨¡æ€æ¡† -->
    <div id="addDeviceModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">æ·»åŠ æˆæƒè®¾å¤‡</h3>
            <p style="color: #64748b; margin-bottom: 20px; font-size: 14px;">
                è¯·è®©æ–°è®¾å¤‡è®¿é—®ç³»ç»Ÿå¹¶å¤åˆ¶å…¶è®¾å¤‡æŒ‡çº¹ï¼š
            </p>
            
            <div class="form-group">
                <label>è®¾å¤‡æŒ‡çº¹ï¼š</label>
                <textarea id="newDeviceFingerprint" class="form-control" rows="4" placeholder="ç²˜è´´æ–°è®¾å¤‡çš„æŒ‡çº¹ä¿¡æ¯"></textarea>
            </div>
            
            <div class="form-group">
                <label>è®¾å¤‡å¤‡æ³¨ï¼š</label>
                <input type="text" id="deviceNote" class="form-control" placeholder="è¾“å…¥è®¾å¤‡æè¿°ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="modal-actions">
                <button class="btn" onclick="closeAddDeviceModal()" style="background: #e5e7eb; color: #374151;">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="addAuthorizedDevice()">æˆæƒè®¾å¤‡</button>
            </div>
        </div>
    </div>

    <script>
        // å®‰å…¨é…ç½®
        const SECURITY_CONFIG = {
            ADMIN_PASSWORD: '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92', // 123456 çš„SHA256
            SESSION_TIMEOUT: 2 * 60 * 60 * 1000, // 2å°æ—¶
            MAX_AUTH_DEVICES: 10
        };

        // è®¾å¤‡æŒ‡çº¹å’Œæˆæƒæ•°æ®
        let deviceFingerprint = null;
        let authorizedDevices = [];
        let currentSession = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeSecurity();
            checkExistingSession();
        });

        // åˆå§‹åŒ–å®‰å…¨ç³»ç»Ÿ
        async function initializeSecurity() {
            // ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
            deviceFingerprint = await generateDeviceFingerprint();
            
            // åŠ è½½æˆæƒè®¾å¤‡åˆ—è¡¨
            loadAuthorizedDevices();
            
            // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
            displayDeviceInfo();
        }

        // ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
        async function generateDeviceFingerprint() {
            const components = [];
            
            // 1. ç”¨æˆ·ä»£ç†ä¿¡æ¯
            components.push(navigator.userAgent);
            components.push(navigator.platform);
            components.push(navigator.language);
            components.push(navigator.hardwareConcurrency || 'unknown');
            
            // 2. å±å¹•ä¿¡æ¯
            components.push(screen.width + 'x' + screen.height);
            components.push(screen.colorDepth + 'bit');
            components.push('avail-' + screen.availWidth + 'x' + screen.availHeight);
            
            // 3. æ—¶åŒºå’Œè¯­è¨€
            components.push(new Date().getTimezoneOffset());
            components.push(navigator.languages ? navigator.languages.join(',') : navigator.language);
            
            // 4. Canvas æŒ‡çº¹
            const canvasFingerprint = await generateCanvasFingerprint();
            components.push(canvasFingerprint);
            
            // 5. WebGL ä¿¡æ¯
            const webglInfo = getWebGLInfo();
            components.push(webglInfo);
            
            // 6. å­—ä½“ä¿¡æ¯
            const fontFingerprint = await generateFontFingerprint();
            components.push(fontFingerprint);
            
            // è®¡ç®—æœ€ç»ˆæŒ‡çº¹
            const fingerprintString = components.join('|');
            return await sha256(fingerprintString);
        }

        // ç”ŸæˆCanvasæŒ‡çº¹
        async function generateCanvasFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 200;
            canvas.height = 50;
            
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillStyle = '#f60';
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = '#069';
            ctx.fillText('Device Fingerprint', 2, 15);
            ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
            ctx.fillText('Device Fingerprint', 4, 17);
            
            return canvas.toDataURL();
        }

        // è·å–WebGLä¿¡æ¯
        function getWebGLInfo() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            
            if (!gl) return 'no-webgl';
            
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            if (debugInfo) {
                return gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) + '|' + 
                       gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            }
            return 'webgl-unknown';
        }

        // ç”Ÿæˆå­—ä½“æŒ‡çº¹
        async function generateFontFingerprint() {
            const testText = "mmMWWLliI0Oo1";
            const fonts = [
                'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
                'Georgia', 'Impact', 'Times New Roman', 'Trebuchet MS',
                'Verdana', 'Microsoft YaHei', 'SimHei', 'SimSun'
            ];
            
            const baseWidth = getTextWidth(testText, 'sans-serif');
            const results = [];
            
            fonts.forEach(font => {
                const width = getTextWidth(testText, font + ', sans-serif');
                if (width !== baseWidth) {
                    results.push(font);
                }
            });
            
            return results.join(',');
        }

        function getTextWidth(text, font) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = font;
            return context.measureText(text).width;
        }

        // SHA256 å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
        function displayDeviceInfo() {
            const deviceInfoDiv = document.getElementById('deviceInfo');
            const shortFingerprint = deviceFingerprint.substring(0, 32) + '...';
            
            deviceInfoDiv.innerHTML = `
                <div class="device-fingerprint">
                    <strong>è®¾å¤‡æŒ‡çº¹ï¼š</strong> ${shortFingerprint}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>è®¾å¤‡çŠ¶æ€ï¼š</span>
                    <span id="deviceStatus" class="status-badge status-unauthorized">æœªæˆæƒ</span>
                </div>
            `;
            
            // æ£€æŸ¥è®¾å¤‡æ˜¯å¦å·²æˆæƒ
            if (isDeviceAuthorized()) {
                document.getElementById('deviceStatus').className = 'status-badge status-authorized';
                document.getElementById('deviceStatus').textContent = 'å·²æˆæƒ';
            } else if (isDevicePending()) {
                document.getElementById('deviceStatus').className = 'status-badge status-pending';
                document.getElementById('deviceStatus').textContent = 'ç­‰å¾…æˆæƒ';
                showPendingSection();
            }
        }

        // æ£€æŸ¥è®¾å¤‡æ˜¯å¦å·²æˆæƒ
        function isDeviceAuthorized() {
            return authorizedDevices.some(device => device.fingerprint === deviceFingerprint);
        }

        // æ£€æŸ¥è®¾å¤‡æ˜¯å¦åœ¨ç­‰å¾…æˆæƒ
        function isDevicePending() {
            const pendingDevices = JSON.parse(localStorage.getItem('pendingDevices') || '[]');
            return pendingDevices.includes(deviceFingerprint);
        }

        // æ˜¾ç¤ºç­‰å¾…æˆæƒç•Œé¢
        function showPendingSection() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('pendingSection').style.display = 'block';
            document.getElementById('pendingFingerprint').textContent = deviceFingerprint;
        }

        // è®¾å¤‡è®¤è¯
        async function authenticateDevice() {
            const password = document.getElementById('adminPassword').value;
            const passwordHash = await sha256(password);
            
            if (passwordHash !== SECURITY_CONFIG.ADMIN_PASSWORD) {
                alert('ç®¡ç†å‘˜å¯†ç é”™è¯¯');
                return;
            }
            
            if (isDeviceAuthorized()) {
                // è®¾å¤‡å·²æˆæƒï¼Œç›´æ¥ç™»å½•
                createSession();
                showAdminPage();
            } else {
                // æ–°è®¾å¤‡ï¼Œæ·»åŠ åˆ°å¾…æˆæƒåˆ—è¡¨
                const pendingDevices = JSON.parse(localStorage.getItem('pendingDevices') || '[]');
                if (!pendingDevices.includes(deviceFingerprint)) {
                    pendingDevices.push(deviceFingerprint);
                    localStorage.setItem('pendingDevices', JSON.stringify(pendingDevices));
                }
                showPendingSection();
                alert('è®¾å¤‡å·²æäº¤æˆæƒç”³è¯·ï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜æˆæƒ');
            }
        }

        // åˆ›å»ºä¼šè¯
        function createSession() {
            currentSession = {
                fingerprint: deviceFingerprint,
                loginTime: new Date().toISOString(),
                expiry: Date.now() + SECURITY_CONFIG.SESSION_TIMEOUT
            };
            localStorage.setItem('currentSession', JSON.stringify(currentSession));
        }

        // æ£€æŸ¥ç°æœ‰ä¼šè¯
        function checkExistingSession() {
            const savedSession = localStorage.getItem('currentSession');
            if (savedSession) {
                const session = JSON.parse(savedSession);
                if (session.expiry > Date.now() && session.fingerprint === deviceFingerprint) {
                    currentSession = session;
                    showAdminPage();
                }
            }
        }

        // æ˜¾ç¤ºç®¡ç†é¡µé¢
        function showAdminPage() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'block';
            
            // æ›´æ–°ç•Œé¢ä¿¡æ¯
            document.getElementById('currentFingerprint').textContent = deviceFingerprint;
            document.getElementById('authTime').textContent = new Date().toLocaleString();
            
            loadAuthorizedDevicesList();
        }

        // åŠ è½½æˆæƒè®¾å¤‡
        function loadAuthorizedDevices() {
            const saved = localStorage.getItem('authorizedDevices');
            if (saved) {
                authorizedDevices = JSON.parse(saved);
            }
        }

        // åŠ è½½æˆæƒè®¾å¤‡åˆ—è¡¨
        function loadAuthorizedDevicesList() {
            const listDiv = document.getElementById('authorizedDevicesList');
            listDiv.innerHTML = '';
            
            authorizedDevices.forEach(device => {
                const isCurrent = device.fingerprint === deviceFingerprint;
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>
                        ${device.note || 'æœªå‘½åè®¾å¤‡'}
                        ${isCurrent ? '<br><small style="color: #10b981;">(å½“å‰è®¾å¤‡)</small>' : ''}
                    </div>
                    <div>${new Date(device.authTime).toLocaleDateString()}</div>
                    <div>
                        <span class="status-badge status-authorized">å·²æˆæƒ</span>
                        ${!isCurrent ? `<button onclick="removeDevice('${device.fingerprint}')" style="margin-left: 8px; background: #ef4444; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px; cursor: pointer;">ç§»é™¤</button>` : ''}
                    </div>
                `;
                listDiv.appendChild(row);
            });
        }

        // æ˜¾ç¤ºæ·»åŠ è®¾å¤‡æ¨¡æ€æ¡†
        function showAddDeviceModal() {
            document.getElementById('addDeviceModal').style.display = 'flex';
        }

        // å…³é—­æ·»åŠ è®¾å¤‡æ¨¡æ€æ¡†
        function closeAddDeviceModal() {
            document.getElementById('addDeviceModal').style.display = 'none';
        }

        // æ·»åŠ æˆæƒè®¾å¤‡
        function addAuthorizedDevice() {
            const fingerprint = document.getElementById('newDeviceFingerprint').value.trim();
            const note = document.getElementById('deviceNote').value.trim();
            
            if (!fingerprint) {
                alert('è¯·è¾“å…¥è®¾å¤‡æŒ‡çº¹');
                return;
            }
            
            if (authorizedDevices.length >= SECURITY_CONFIG.MAX_AUTH_DEVICES) {
                alert(`å·²è¾¾åˆ°æœ€å¤§æˆæƒè®¾å¤‡æ•°é‡ (${SECURITY_CONFIG.MAX_AUTH_DEVICES})`);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (authorizedDevices.some(device => device.fingerprint === fingerprint)) {
                alert('è¯¥è®¾å¤‡å·²æˆæƒ');
                return;
            }
            
            // æ·»åŠ æ–°è®¾å¤‡
            authorizedDevices.push({
                fingerprint: fingerprint,
                note: note,
                authTime: new Date().toISOString()
            });
            
            // ä»å¾…æˆæƒåˆ—è¡¨ä¸­ç§»é™¤
            const pendingDevices = JSON.parse(localStorage.getItem('pendingDevices') || '[]');
            const updatedPending = pendingDevices.filter(fp => fp !== fingerprint);
            localStorage.setItem('pendingDevices', JSON.stringify(updatedPending));
            
            // ä¿å­˜æˆæƒè®¾å¤‡åˆ—è¡¨
            localStorage.setItem('authorizedDevices', JSON.stringify(authorizedDevices));
            
            closeAddDeviceModal();
            loadAuthorizedDevicesList();
            showToast('è®¾å¤‡æˆæƒæˆåŠŸ');
        }

        // ç§»é™¤è®¾å¤‡
        function removeDevice(fingerprint) {
            if (!confirm('ç¡®å®šè¦ç§»é™¤è¯¥è®¾å¤‡çš„æˆæƒå—ï¼Ÿ')) return;
            
            authorizedDevices = authorizedDevices.filter(device => device.fingerprint !== fingerprint);
            localStorage.setItem('authorizedDevices', JSON.stringify(authorizedDevices));
            loadAuthorizedDevicesList();
            showToast('è®¾å¤‡å·²ç§»é™¤');
        }

        // å®‰å…¨é€€å‡º
        function logout() {
            localStorage.removeItem('currentSession');
            location.reload();
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message) {
            alert(message); // ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…å¯ä»¥ä½¿ç”¨æ›´æ¼‚äº®çš„Toastç»„ä»¶
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('addDeviceModal');
            if (event.target === modal) {
                closeAddDeviceModal();
            }
        }
    </script>
</body>
</html>
