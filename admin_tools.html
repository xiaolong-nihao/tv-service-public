<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡æˆæƒç®¡ç†</title>
    <style>
        /* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œåªæ·»åŠ æ–°çš„æ ·å¼ */
        
        /* æ–°å¢ï¼šè®¾å¤‡æ“ä½œæŒ‰é’®æ ·å¼ */
        .device-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }
        
        .device-actions .btn {
            padding: 4px 8px;
            font-size: 11px;
            width: auto;
            flex: 1;
        }
        
        /* è°ƒæ•´è¡¨æ ¼å¸ƒå±€ä¸º4åˆ— */
        .table-header {
            grid-template-columns: 1fr 1.5fr 0.8fr 1.2fr;
        }
        
        .table-row {
            grid-template-columns: 1fr 1.5fr 0.8fr 1.2fr;
        }
    </style>
</head>
<body>
    <!-- é¡µé¢ç»“æ„ä¿æŒä¸å˜ -->

    <script>
        // æˆæƒçš„ GitHub è´¦å·å’Œå¯†ç 
        const AUTHORIZED_USERS = {
            'xiaolong-nihao': '123456'  // ç”¨æˆ·å: å¯†ç 
        };
        
        // ç¤ºä¾‹è®¾å¤‡æ•°æ®
        let devices = [
            {
                id: "TV123456789",
                package: "yearly",
                activate_date: "2024-01-01",
                expire_date: "2024-12-31",
                status: "active",
                days: 365
            },
            {
                id: "865123456789012", 
                package: "monthly",
                activate_date: "2024-01-10",
                expire_date: "2024-02-09",
                status: "active",
                days: 30
            }
        ];

        // GitHub ç™»å½• - ä¿®å¤å¯†ç éªŒè¯
        function loginWithGitHub() {
            const username = document.getElementById('githubUsername').value.trim();
            const password = document.getElementById('githubPassword').value.trim();
            
            if (!username || !password) {
                showToast('è¯·è¾“å…¥ GitHub ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            // éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
            if (AUTHORIZED_USERS[username] && AUTHORIZED_USERS[username] === password) {
                currentUser = {
                    name: username,
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('githubUser', JSON.stringify(currentUser));
                showAdminPage();
                showToast('GitHub ç™»å½•æˆåŠŸï¼');
            } else {
                showToast('âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
            }
        }

        // åŠ è½½è®¾å¤‡åˆ—è¡¨ - ä¿®æ”¹ä¸ºä¸€è¡Œæ˜¾ç¤ºæ“ä½œæŒ‰é’®
        function loadDevices() {
            const devicesList = document.getElementById('devicesList');
            devicesList.innerHTML = '';
            
            devices.forEach((device, index) => {
                const isPermanent = device.package === "permanent";
                const isExpired = !isPermanent && new Date(device.expire_date) < new Date();
                const daysRemaining = isPermanent ? Infinity : Math.ceil((new Date(device.expire_date) - new Date()) / (1000 * 60 * 60 * 24));
                
                let statusClass = 'status-active';
                let statusText = 'æœ‰æ•ˆ';
                
                if (isPermanent) {
                    statusClass = 'status-permanent';
                    statusText = 'æ°¸ä¹…';
                } else if (isExpired) {
                    statusClass = 'status-expired';
                    statusText = 'å·²è¿‡æœŸ';
                } else if (daysRemaining <= 7) {
                    statusClass = 'status-warning';
                    statusText = 'å³å°†åˆ°æœŸ';
                }
                
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>${device.id}</div>
                    <div>${device.expire_date} ${!isPermanent && !isExpired ? `<br><small>å‰©ä½™ ${daysRemaining} å¤©</small>` : ''}</div>
                    <div>
                        <span class="status-badge ${statusClass}">
                            ${statusText}
                        </span>
                    </div>
                    <div class="device-actions">
                        <button class="btn btn-warning" onclick="extendDevice('${device.id}')" title="å»¶é•¿åˆ°æœŸæ—¶é—´">
                            â±ï¸ å»¶é•¿
                        </button>
                        <button class="btn btn-danger" onclick="deleteDevice('${device.id}')" title="åˆ é™¤è®¾å¤‡">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </div>
                    <div class="device-details">
                        <div><strong>æ¿€æ´»æ—¥æœŸ:</strong> ${device.activate_date}</div>
                        <div><strong>å¥—é¤ç±»å‹:</strong> ${getPackageText(device.package)}</div>
                        <div><strong>æˆæƒå¤©æ•°:</strong> ${device.days || 'æ°¸ä¹…'}</div>
                    </div>
                `;
                devicesList.appendChild(row);
            });
        }

        // å»¶é•¿è®¾å¤‡åˆ°æœŸæ—¶é—´
        function extendDevice(deviceId) {
            const device = devices.find(d => d.id === deviceId);
            if (!device) return;
            
            if (device.package === "permanent") {
                showToast('æ°¸ä¹…æˆæƒè®¾å¤‡æ— éœ€å»¶é•¿');
                return;
            }
            
            const extendDays = prompt(`è¯·è¾“å…¥è¦ä¸ºè®¾å¤‡ ${deviceId} å»¶é•¿çš„å¤©æ•°:`, "30");
            if (extendDays && !isNaN(extendDays) && extendDays > 0) {
                const days = parseInt(extendDays);
                const currentExpireDate = new Date(device.expire_date);
                currentExpireDate.setDate(currentExpireDate.getDate() + days);
                
                device.expire_date = currentExpireDate.toISOString().split('T')[0];
                device.days = (device.days || 0) + days;
                
                loadDevices();
                updateStats();
                showToast(`âœ… è®¾å¤‡ ${deviceId} å·²å»¶é•¿ ${days} å¤©`);
            } else {
                showToast('å»¶é•¿æ“ä½œå·²å–æ¶ˆ');
            }
        }

        // å…¶ä½™å‡½æ•°ä¿æŒä¸å˜...
    </script>
</body>
</html>
